<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- List view for payu.credential -->
    <record id="view_payu_credential_list" model="ir.ui.view">
        <field name="name">payu.credential.list</field>
        <field name="model">payu.credential</field>
        <field name="arch" type="xml">
            <list string="PayU Credentials" editable="bottom">
                <field name="currency_id"  width="80" />
                <field name="merchant_key" password="1"  width="130" />
                <field name="merchant_salt" password="1"  width="130" />
                <field name="cross_border_transactions" width="130" />
            </list>
        </field>
    </record>

    <!-- Form view for payu.credential -->
    <record id="view_payu_credential_form" model="ir.ui.view">
        <field name="name">payu.credential.form</field>
        <field name="model">payu.credential</field>
        <field name="arch" type="xml">
            <form string="PayU Credential">
                <group>
                    <field name="currency_id" required="1"  />
                    <field name="merchant_key" password="1" required="1"  />
                    <field name="merchant_salt" password="1" required="1"  />
                    <field name="cross_border_transactions" />
                </group>
            </form>
        </field>
    </record>

    <!-- Extend payment.provider form to add multi-currency credentials -->
    <record id="payment_provider_form_payu" model="ir.ui.view">
        <field name="name">PayU Provider Form</field>
        <field name="model">payment.provider</field>
        <field name="inherit_id" ref="payment.payment_provider_form" />
        <field name="arch" type="xml">
            <xpath expr="//page[@name='credentials']/group" position="after">

                <group invisible="code != 'payu' or state == 'disabled'">
                    <field name="payu_credential_ids" mode="list,form" options="{'list_view_ref': 'payment_payu.view_payu_credential_list', 'form_view_ref': 'payment_payu.view_payu_credential_form'}"/>
                    
                    <!-- Save Credentials button -->
                    <button string="Save Credentials" type="object"
                        name="action_save_payu_credentials" class="btn-primary" />
                </group>

                <group name="payu_sign_up" string="Register with PayU"
                    invisible="code != 'payu' or state == 'disabled'">
                    <div>New to PayU? Click on below button to start accepting payments using PayU!</div>
                </group>

                <group invisible="code != 'payu' or state == 'disabled'">
                    <div>
                        <button string="Sign Up" type="object" name="action_payu_signup_redirect"
                            class="btn-primary" />
                    </div>
                </group>


            </xpath>
        </field>
    </record>

    <!-- Payment transaction form extension for refund -->
    <record id="view_payment_transaction_form_inherit_refund" model="ir.ui.view">
        <field name="name">payment.transaction.form.inherit.refund</field>
        <field name="model">payment.transaction</field>
        <field name="inherit_id" ref="payment.payment_transaction_form" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='provider_reference']" position="after">
                <field name="refund_bank_reference" invisible="is_refund != True" />
            </xpath>
        </field>
    </record>

    <record id="view_payment_transaction_form_inherit_settled_amount" model="ir.ui.view">
        <field name="name">payment.transaction.form.settled.amount.inherit</field>
        <field name="model">payment.transaction</field>
        <field name="inherit_id" ref="payment.payment_transaction_form" />
        <field name="arch" type="xml">
            <!-- Insert the field after 'Provider Reference' -->
            <xpath expr="//field[@name='provider_reference']" position="after">
                <field name="settled_amount" />
            </xpath>
        </field>
    </record>

    <record id="view_payment_transaction_form_inherit_service_amount" model="ir.ui.view">
        <field name="name">payment.transaction.form.service.amount.inherit</field>
        <field name="model">payment.transaction</field>
        <field name="inherit_id" ref="payment.payment_transaction_form"/>
        <field name="arch" type="xml">
            <!-- Insert the field after 'Provider Reference' -->
            <xpath expr="//field[@name='settled_amount']" position="after">
                <field name="total_service_fee" />
            </xpath>
        </field>
    </record>
</odoo>